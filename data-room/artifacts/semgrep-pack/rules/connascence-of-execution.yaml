# Connascence of Execution (CoE) Rules  
# Detects method call ordering dependencies and execution flow coupling

rules:
  - id: method-call-ordering-dependency
    message: |
      Method call ordering dependency detected (CoE).
      Methods must be called in specific sequence for correct behavior.
      
      Enterprise impact: Fragile APIs that break when call order changes.
      Consider designing methods to be order-independent or use builder pattern.
    severity: ERROR
    languages: [javascript, typescript, java, csharp]
    patterns:
      - pattern-either:
          - pattern: |
              $OBJ.init();
              $OBJ.configure($CONFIG);
              $OBJ.start();
          - pattern: |
              $CONNECTION.open();
              $CONNECTION.authenticate($CREDS);
              $CONNECTION.query($SQL);
          - pattern: |
              $BUILDER.setProperty1($VALUE1);
              $BUILDER.setProperty2($VALUE2);
              $BUILDER.build();
    metadata:
      category: connascence-of-execution
      subcategory: method-ordering
      confidence: HIGH
      impact: HIGH
      effort: MEDIUM
      api_fragility: HIGH
      enterprise_priority: HIGH

  - id: state-machine-execution-coupling
    message: |
      State machine execution coupling detected (CoE).
      State transitions depend on specific method execution order.
      
      Consider explicit state validation or state machine library.
    severity: WARNING
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: |
              if ($STATE === 'initial') {
                $OBJ.start();
                $STATE = 'running';
              }
              if ($STATE === 'running') {
                $OBJ.process();
                $STATE = 'complete';
              }
          - pattern: |
              switch($STATUS) {
                case 'pending':
                  $OBJ.begin();
                  break;
                case 'processing':
                  $OBJ.finish();
                  break;
              }
    metadata:
      category: connascence-of-execution
      subcategory: state-transitions
      confidence: MEDIUM
      impact: MEDIUM
      effort: HIGH

  - id: setup-teardown-execution-order
    message: |
      Setup/teardown execution order dependency (CoE).
      Resource setup and cleanup must occur in specific sequence.
      
      Enterprise concern: Resource leaks when execution order breaks.
    severity: ERROR
    languages: [javascript, typescript, python, java]
    patterns:
      - pattern-either:
          - pattern: |
              beforeEach(() => {
                setupDatabase();
                setupAuth();
                setupCache();
              });
              afterEach(() => {
                cleanupCache();
                cleanupAuth();
                cleanupDatabase();
              });
          - pattern: |
              $RESOURCE1.setup();
              $RESOURCE2.setup();
              // ... test code ...
              $RESOURCE2.cleanup();
              $RESOURCE1.cleanup();
    metadata:
      category: connascence-of-execution
      subcategory: setup-teardown
      confidence: HIGH
      impact: HIGH
      effort: MEDIUM
      resource_management: CRITICAL

  - id: pipeline-execution-coupling
    message: |
      Data pipeline execution coupling detected (CoE).
      Pipeline stages must execute in specific order with data dependencies.
      
      Consider explicit dependency declaration or pipeline orchestration.
    severity: WARNING
    languages: [javascript, typescript, python]
    patterns:
      - pattern-either:
          - pattern: |
              const step1Result = await processStep1($DATA);
              const step2Result = await processStep2(step1Result);
              const step3Result = await processStep3(step2Result);
              return step3Result;
          - pattern: |
              $DATA
                .pipe(transform1)
                .pipe(transform2)
                .pipe(transform3);
    metadata:
      category: connascence-of-execution
      subcategory: pipeline-stages
      confidence: MEDIUM
      impact: MEDIUM
      effort: HIGH

  - id: lifecycle-hook-execution-order
    message: |
      Lifecycle hook execution order dependency (CoE).
      Component lifecycle depends on specific hook execution sequence.
      
      Framework lifecycle methods create execution coupling.
    severity: INFO
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: |
              componentDidMount() {
                this.initializeData();
              }
              componentDidUpdate() {
                this.updateData();
              }
              componentWillUnmount() {
                this.cleanupData();
              }
          - pattern: |
              useEffect(() => {
                setup();
                return () => cleanup();
              }, []);
    metadata:
      category: connascence-of-execution
      subcategory: lifecycle-hooks
      confidence: LOW
      impact: LOW
      effort: LOW
      framework_coupling: MEDIUM

  - id: transaction-execution-sequence
    message: |
      Transaction execution sequence dependency (CoE).
      Database operations must execute in specific order within transaction.
      
      Enterprise risk: Data consistency violations if execution order changes.
    severity: ERROR
    languages: [javascript, typescript, python, java]
    patterns:
      - pattern-either:
          - pattern: |
              await transaction.begin();
              await transaction.insert($DATA1);
              await transaction.update($DATA2);
              await transaction.delete($DATA3);
              await transaction.commit();
          - pattern: |
              BEGIN TRANSACTION;
              INSERT INTO $TABLE1 VALUES ($VALUES);
              UPDATE $TABLE2 SET $UPDATES;
              COMMIT;
    metadata:
      category: connascence-of-execution
      subcategory: transaction-sequence
      confidence: HIGH
      impact: CRITICAL
      effort: MEDIUM
      data_integrity: CRITICAL

  - id: api-workflow-execution-coupling
    message: |
      API workflow execution coupling detected (CoE).
      API calls must be made in specific sequence for workflow completion.
      
      Enterprise impact: Integration brittleness when API call order changes.
    severity: ERROR
    languages: [javascript, typescript, python]
    patterns:
      - pattern-either:
          - pattern: |
              const auth = await authenticate($CREDS);
              const data = await fetchData(auth.token);
              const result = await processData(data.payload);
              await saveResult(result.output);
          - pattern: |
              await api.login($USER);
              await api.selectAccount($ACCOUNT);
              await api.performOperation($OPERATION);
              await api.logout();
    metadata:
      category: connascence-of-execution
      subcategory: api-workflow
      confidence: HIGH
      impact: HIGH
      effort: MEDIUM
      integration_stability: HIGH

  - id: event-dispatch-execution-order
    message: |
      Event dispatch execution order dependency (CoE).
      Events must be dispatched in specific sequence for correct behavior.
      
      Consider event sequencing or choreography patterns.
    severity: WARNING
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: |
              emit('before-operation', $DATA);
              const result = performOperation($DATA);
              emit('after-operation', result);
          - pattern: |
              dispatch('START_LOADING');
              const data = await fetchData();
              dispatch('SET_DATA', data);
              dispatch('STOP_LOADING');
    metadata:
      category: connascence-of-execution
      subcategory: event-sequencing
      confidence: MEDIUM
      impact: MEDIUM
      effort: MEDIUM

  - id: dependency-injection-execution-order
    message: |
      Dependency injection execution order coupling (CoE).
      Dependencies must be injected in specific order.
      
      Consider using dependency injection container with automatic ordering.
    severity: WARNING
    languages: [javascript, typescript, java, csharp]
    patterns:
      - pattern-either:
          - pattern: |
              container.register('$SERVICE1', $IMPL1);
              container.register('$SERVICE2', $IMPL2);
              // $SERVICE2 depends on $SERVICE1
          - pattern: |
              const service1 = new $SERVICE1();
              const service2 = new $SERVICE2(service1);
              const service3 = new $SERVICE3(service1, service2);
    metadata:
      category: connascence-of-execution
      subcategory: dependency-injection
      confidence: LOW
      impact: MEDIUM
      effort: HIGH