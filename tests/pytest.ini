[pytest]
minversion = 7.0
testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=analyzer
    --cov=autofix
    --cov=policy
    --cov=reporting
    --cov=cli
    --cov=mcp
    --cov-report=term-missing
    --cov-report=html:enterprise-package/artifacts/coverage
    --cov-report=xml:tests/results/coverage.xml
    # Coverage threshold: 85% target for full suite, 5% minimum for partial/isolated runs
    # Note: Set lower to prevent failures after coverage DB rebuild or isolated test runs
    --cov-fail-under=5
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    e2e: marks tests as end-to-end tests
    autofix: marks tests related to autofix functionality
    mcp: marks tests related to MCP server functionality
    property: marks tests as property-based tests
    performance: marks tests that measure performance
    enhanced: marks tests for enhanced pipeline integration
    vscode: marks tests for VSCode extension enhanced features
    mcp_server: marks tests for MCP server enhanced integration
    web_dashboard: marks tests for Web dashboard enhanced visualizations
    cli: marks tests for CLI interface enhanced features
    end_to_end: marks tests for complete workflow validation
    correlation_analysis: marks tests for cross-phase correlation features
    smart_recommendations: marks tests for AI-powered recommendations
    audit_trail: marks tests for analysis audit trail functionality
    error_handling: marks tests for error handling and recovery
    edge_cases: marks tests for edge case scenarios
    user_experience: marks tests for user experience validation
    scalability: marks tests for scalability and performance benchmarks
    real_world: marks tests using realistic codebase patterns
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:.*unclosed.*:ResourceWarning
norecursedirs = 
    .git
    tests/.pytest_cache
    *.egg-info
    build
    dist
    node_modules
    venv
    __pycache__

# Test output configuration
junit_family = xunit2
log_file = tests/results/pytest.log
log_file_level = INFO